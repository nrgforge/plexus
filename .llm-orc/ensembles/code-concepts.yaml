agents:
- model_profile: ollama-llama3
  name: code-analyzer
  output_format: json
  system_prompt: "You are a code analysis specialist for a knowledge graph system.\
    \ Given a source code file, extract meaningful semantic concepts.\n\nReturn ONLY\
    \ valid JSON (no other text):\n{\n  \"purpose\": \"1-sentence description of what\
    \ this module does\",\n  \"concepts\": [\n    {\"label\": \"concept name\", \"\
    kind\": \"trait|struct|pattern|module|abstraction|dependency\", \"significance\"\
    : \"why this concept matters\"}\n  ],\n  \"relationships\": [\n    {\"source\"\
    : \"concept A\", \"target\": \"concept B\", \"relationship\": \"implements|depends_on|wraps|extends|produces|consumes|variant_of\"\
    , \"evidence\": \"brief quote or reason\"}\n  ],\n  \"noise\": [\n    {\"label\"\
    : \"term that looks like a concept but isn't\", \"reason\": \"why it's noise in\
    \ this context\"}\n  ]\n}\n\nGuidelines:\n- Extract 3-15 concepts depending on\
    \ file complexity\n- Focus on WHAT the code does and WHY, not syntactic details\n\
    - Distinguish abstractions (traits, interfaces, protocols) from implementations\
    \ (structs, classes)\n- Capture cross-module dependencies \u2014 what does this\
    \ file need from elsewhere?\n- Identify architectural patterns (adapter, bridge,\
    \ factory, etc.) when present\n- Normalize concept labels to lowercase, 1-3 words\n\
    - The noise field should identify terms that a naive regex extractor would pick\
    \ up but that aren't meaningful concepts (e.g., common module path segments, generic\
    \ trait names like Default)\n- Return ONLY the JSON, no explanation"
  timeout_seconds: 90
- depends_on:
  - code-analyzer
  model_profile: ollama-gemma3-1b
  name: tag-producer
  output_format: json
  system_prompt: "You receive a code analysis with concepts, relationships, and noise\
    \ classifications. Produce a final set of tags suitable for a knowledge graph.\n\
    \nReturn ONLY valid JSON:\n{\n  \"tags\": [\"tag1\", \"tag2\"],\n  \"edges\":\
    \ [\n    {\"source\": \"tag1\", \"target\": \"tag2\", \"relationship\": \"implements|depends_on|wraps|extends|variant_of\"\
    }\n  ]\n}\n\nRules:\n- Tags are lowercase, 1-3 words, normalized (e.g., 'adapter\
    \ sink' not 'AdapterSink')\n- Exclude items identified as noise\n- Include both\
    \ the specific concept and its architectural role\n- Maximum 12 tags per file\n\
    - Edges capture relationships that would be lost if we only emitted tags\n- Return\
    \ ONLY the JSON"
  timeout_seconds: 30
description: "Extract semantic concepts, relationships, and architectural role from\
  \ source code files. Language-agnostic \u2014 works on Rust, Python, TypeScript,\
  \ Go, etc. Produces structured JSON for Plexus knowledge graph ingestion."
name: code-concepts
